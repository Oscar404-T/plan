{% extends 'base.html' %}
{% block title %}创建订单 — Plan 排产系统{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title">创建订单</h2>
        {% if error %}<div class="alert alert-danger">{{ error }}</div>{% endif %}
        <form method="post" action="/ui/orders/create">
          <div class="mb-3">
            <label class="form-label">内部型号</label>
            <input name="internal_model" type="text" class="form-control">
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label class="form-label form-required">长度（mm）</label>
              <input id="length" name="length" type="number" step="0.01" class="form-control" required>
            </div>
            <div class="col-md-6 mb-3">
              <label class="form-label form-required">宽度（mm）</label>
              <input id="width" name="width" type="number" step="0.01" class="form-control" required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label class="form-label">尺寸（英寸）</label>
              <input id="size" name="size" type="number" step="0.01" class="form-control" readonly>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label form-required">数量</label>
              <input name="quantity" type="number" class="form-control" required>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">估计良率（%）</label>
              <input name="estimated_yield" type="number" step="0.01" min="0" max="100" class="form-control">
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label form-required">截止时间</label>
            <input name="due_datetime" type="datetime-local" class="form-control" required>
          </div>

          <h5>工序与产能（每小时件数） — 留空使用默认值</h5>
          <div class="row">
            {% for op in operations %}
            <div class="col-md-6 mb-2">
              <label class="form-label">{{ op.name }}</label>
              <input name="op_{{ op.id }}" type="number" placeholder="件/小时" class="form-control">
            </div>
            {% endfor %}
          </div>

          <div class="mt-3">
            <button type="submit" class="btn btn-success">创建订单</button>
            <a class="btn btn-secondary ms-2" href="/ui/logout">登出</a>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  function computeSize(){
    const l = parseFloat(document.getElementById('length').value) || 0;
    const w = parseFloat(document.getElementById('width').value) || 0;
    const size = Math.sqrt(l*l + w*w) / 25.4;
    const out = Math.round(size * 100) / 100;
    document.getElementById('size').value = out.toFixed(2);
  }
  document.getElementById('length').addEventListener('input', computeSize);
  document.getElementById('width').addEventListener('input', computeSize);
  window.addEventListener('load', computeSize);
</script>
{% endblock %}
